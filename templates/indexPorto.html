<!DOCTYPE html>
<html>

<head>
    <title>Synchronize.js plain html5 test</title>

    <!--
    <link href="/static/css/main.css" rel="stylesheet">
-->
    <style>
        body {
  width: 100%;
  margin: 0 auto;
  background: rgba(129, 28, 128, 0.21);
}
.full-img {
  position: relative;
  display: block;
  width: 640px;
  height: 480px;
}
.gallery-bar img {
  display: block;
  width: 20%;
  float: left;
  cursor: pointer;
  opacity: 1;
}
.gallery-bar img:hover {
  opacity: 0.5;
}

.gallery-label {
    width:100%;
    height:50px;
}
.gallery-label span {
  display: flex;
  float: left;
  cursor: pointer;
  opacity: 1;
}
    </style>
    <script src="/static/js/lib/jquery.js"></script>
    <script src="/static/js/synchronize.js"></script>
    <script src="/static/js/main.js"></script>
</head>

<body>
    <center>
        <div class="full-img">
                <canvas id="canvas"></canvas>
            </div>
        </center>
                <div class="gallery-bar">
    <div class="videoWrapper">  
    
        {% for v in listvideo %}
         {% if loop.index == 1 %}
         <video id="example_video_{{loop.index}}" class="video" controls  width="{{percent}}%" poster="img/oceans-clip.png" mediagroup="videoMG1">
            <source src="/static/video/{{v}}" type='video/mp4' />            
        </video>
         {% else %}
         <video id="example_video_{{loop.index}}" class="video"  width="{{percent}}%" poster="img/oceans-clip.png" mediagroup="videoMG1">
            <source src="/static/video/{{v}}" type='video/mp4' />            
        </video>
         {% endif %}
        
        {% endfor %}
        
    </div>
</div>
    <div class="gallery-label">
    {% for v in listvideo %}
    <span id="titre{{loop.index}}" style="width:{{percent}}%" onclick="grow({{loop.index}})">  {{v}} </span>
    {% endfor %}
    </div>
    <br/>
    <div class="clear">
        Current time:
        <span id="currentTime">0</span> seconds.
        <span id="bufferInfo">Initializing players...</span>
    </div>
</body>
<script>

    let displayedImg = document.querySelector("img.displayed-img");
    let images =  document.querySelectorAll(".gallery-bar video");

    for(let i = 0; i < images.length; i++){
        images[i].onclick = function(event){
            displayedImg.setAttribute("src", event.target.src);
        }
    }

    function grow(index) {
        console.log(index);
    }

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');

    var video = document.getElementById('example_video_1');

// set canvas size = video size when known
    video.addEventListener('loadedmetadata', function() {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.left = (document.width - video.videoWidth)/2;
    });

    video.addEventListener('play', function() {
     var $this = this; //cache
    (function loop() {
        if (!$this.paused && !$this.ended) {
        ctx.drawImage($this, 0, 0);
        setTimeout(loop, 1000 / 30); // drawing at 30fps
        }
    })();
    }, 0);
</script>
</html>